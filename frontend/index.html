<html>
  <head>
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="663738583895-j4jqbv3239r6ftqimkbv1fic036oe8cc.apps.googleusercontent.com">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
  </head>
  <body>
    <div class="container" style="margin-top:250px; border:1px solid black; padding:100px 100px 100px 100px;">
      <div class="row">
        <div class="col">
          <div style="width:200px" class="g-signin2" data-onsuccess="onSignIn" data-theme="dark" id="btnGoogle"></div><br>
        </div>
        <div class="col">
          <button class="btn btn-danger d-none" id="signOutBtn" onclick="signOut()">Sign out</button><br><br>
        </div>
        <div class="col">
          <a class="btn btn-warning d-none" id="goToLoginBtn" href="login.html">Menj az oldalra</a>
        </div>
      </div>
    </div>
    <script>
      
      function init() {
        gapi.load('auth2');
      }

      function onSignIn(googleUser) {

       localStorage.setItem('email', googleUser.getBasicProfile().getEmail());

        if (googleUser.isSignedIn()) {
  
          $('#signOutBtn').removeClass('d-none');
          $('#goToLoginBtn').removeClass('d-none');
          $('#btnGoogle').addClass('d-none');

          $.post('http://localhost:8888/api/login/verify', {
            'email': googleUser.getBasicProfile().getEmail(),
            'first_name':googleUser.getBasicProfile().getGivenName(),
            'last_name':googleUser.getBasicProfile().getFamilyName(),
            'google_token': googleUser.getAuthResponse().id_token,
          })
          .done(function(res){
            console.log(res);
            console.log(localStorage);
          })
          .fail(function(error){
            console.log(error);
          })
        } 
      }
      
      function signOut(){
        let auth2 = gapi.auth2.getAuthInstance();
        gapi.auth2.getAuthInstance().signOut().then(function(){
          console.log('User signed out');
          localStorage.clear();
          $('#signOutBtn').addClass('d-none');
          $('#goToLoginBtn').addClass('d-none');
          $('#btnGoogle').removeClass('d-none');
        })
      }  
    </script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>